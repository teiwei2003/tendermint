# ADR 057:RPC

## 变更日志

- 19-05-2020:创建

## 语境

目前，Tendermint 的 RPC 层使用的是 JSON-RPC 协议的变体.此 ADR 旨在用作可能的替代方案和 JSON-RPC 的利弊列表.

目前正在讨论两个选项:gRPC 和 JSON-RPC.

### JSON-RPC

JSON-RPC 是一种基于 JSON 的 RPC 协议. Tendermint 已经实现了自己的 JSON-RPC 变体，该变体与 [JSON-RPC 2.0 规范](https://www.jsonrpc.org/specification) 不兼容.

**优点:**

- 易于使用和实施(默认情况下)
- 为用户和集成商所熟知和理解
- 与 Web 基础设施(代理、API 网关、服务网格、缓存等)结合得相当好
- 人类可读的编码(默认)

**缺点:**

- 无模式支持
- RPC 客户端必须是手写的
- 流媒体未内置到协议中
- 未指定类型(例如数字和时间戳)
- Tendermint 有自己的实现(不符合标准，维护开销)
  - 与此相关的高维护成本
- Stdlib `jsonrpc` 包仅支持 JSON-RPC 1.0，不支持 JSON-RPC 2.0 的主要包
- 围绕文档/规范(例如 Swagger)的工具可能会更好
- JSON 数据更大(被 HTTP 压缩抵消)
- 序列化很慢([~100% marshal，~400% unmarshal](https://github.com/alectomas/go_serialization_benchmarks))；绝对值微不足道
- 规范最后一次更新是在 2013 年，远远落后于 Swagger/OpenAPI

### gRPC + gRPC 网关(REST + Swagger)

gRPC 是一个高性能的 RPC 框架.它已经过大量用户的实战测试，并受到无数大公司的高度依赖和维护.

**优点:**

- 为用户、精简版客户端和其他协议进行高效的数据检索
- 以支持的语言轻松实现(Go、Dart、JS、TS、rust、Elixir、Haskell 等)
- 具有更丰富的类型系统(协议缓冲区)的定义模式
- 可以在所有协议和数据存储(RPC、ABCI、块等)中使用通用模式和类型
- 建立向前和向后兼容性的约定
- 双向流媒体
- 服务器和客户端以多种语言自动生成(例如 Tendermint-rs)
- 为 REST API 自动生成 swagger 文档
- 在协议级别强制执行的向后和向前兼容性保证.
- 可用于不同的编解码器(JSON、CBOR、...)

**缺点:**

- 涉及跨语言模式、代码生成和自定义协议的复杂系统
- 类型系统并不总是清晰地映射到本地语言类型系统；整合困境
- 许多常见类型需要 Protobuf 插件(例如时间戳和持续时间)
- 生成的代码可能不惯用且难以使用
- 迁移将是破坏性和费力的

## 决定

> 本节解释了所提议解决方案的所有细节，包括实施细节.
> 它还应该描述作为其中一部分可能需要更改的影响/必然项.
> 如果提议的更改很大，请同时说明进行更改的方式，以最大限度地方便审查.
>(例如，在单独的 PR 之间做的事情的最佳分割)

## 状态

> 如果尚未达成一致，可以“提出”决定，或者一旦达成一致就“接受”.如果以后的 ADR 更改或撤消了决定，则可以将其标记为“已弃用”或“已取代”，并提及其替代品.

{已弃用|建议|接受}

## 结果

> 本节描述了应用决定后的后果.所有的后果都应该在这里总结，而不仅仅是“积极的”后果.

### 积极的

### 消极的

### 中性的

## 参考

> 是否有任何相关的 PR 评论、导致此问题的问题，或关于我们为何做出给定设计选择的参考文章？如果是这样，请在此处链接它们！

- {参考链接}
