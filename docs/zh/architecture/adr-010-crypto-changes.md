# ADR 010:加密货币变化

## 语境

Tendermint 是一种加密协议，它使用和组合了各种加密原语.

经过近 4 年的发展，Tendermint 最近经历了多次安全审查，以寻找漏洞并评估密码原语的使用和组成.

### 哈希函数

Tendermint 普遍使用 RIPEMD160 作为哈希函数，尤其是在其 Merkle 树实现中.

选择 RIPEMD160 是因为它提供了最短的指纹，其长度足以被认为是安全的(即 80 位的生日界限).
与 SHA256 等 NSA 设计的算法不同，它也是在开放的学术社区中开发的.

也就是说，加密社区似乎一致同意 SHA256 的安全性.它已成为通用标准，尤其是现在 SHA1 已被破坏，在 TLS 连接中需要它并在硬件中得到优化支持.

###默克尔树

Tendermint 使用简单的 Merkle 树来计算大型结构的摘要，例如交易批次
甚至区块链标题. Merkle 树长度在连接和散列它们之前为字节数组添加前缀.
它使用 RIPEMD160.

### 地址

ED25519 地址是使用公钥的氨基编码的 RIPEMD160 计算的.
RIPEMD160 通常被认为是过时的哈希函数，而且速度要慢得多
比更现代的函数，如 SHA256 或 Blake2.

### 认证加密

Tendermint P2P 连接使用经过身份验证的加密来提供通信中的隐私和身份验证.
这是通过使用 NaCL Ed25519 库的简单站对站协议完成的.

虽然在实施中没有发现漏洞，但存在一些问题:

- NaCL 使用 Salsa20，这是一种使用不广泛且相对过时的流密码，已被 ChaCha20 淘汰
- 连接使用 RIPEMD160 计算用于加密随机数的值，对其使用方式有细微的要求

## 决定

### 哈希函数

对所有内容使用 SHA256 哈希值的前 20 个字节而不是 RIPEMD160

###默克尔树

去做

### 地址

将 ED25519 地址计算为原始 32 字节公钥的 SHA256 的前 20 字节

### 认证加密

进行以下更改:

- 使用 xChaCha20 代替 xSalsa20 - https://github.com/tendermint/tendermint/issues/1124
- 使用 HKDF 而不是 RIPEMD160 来计算随机数 - https://github.com/tendermint/tendermint/issues/1165

## 状态

实施的

## 结果

### 积极的

- 具有更广泛采用和硬件加速的更现代和标准的加密功能

### 消极的

- 使用良好的库中尚未提供精确的经过身份验证的加密构造

### 中性的

## 参考
