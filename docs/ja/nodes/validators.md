# バリデーター

ベリファイアは、ブロックチェーン内の新しいブロックを送信する責任があります.
これらのバリデーターは、ブロードキャストによってコンセンサスプロトコルに参加します
_votes_には、全員が署名した暗号署名が含まれています
ベリファイアの秘密鍵.

一部のPoSコンセンサスアルゴリズムは、「完全な」作成を目的としています
分散型システム、すべての利害関係者(そうでない人も含む)
いつでもオンラインで利用可能)ブロックの提出に参加します.
Tendermintには、ブロックを作成する別の方法があります.バリデーターは
オンラインであることが期待され、バリデーターセットはライセンス/計画されています
いくつかの外部プロセスを通じて.公平性の証明は必要ありませんが、
テンダーミントのコンセンサスの上に実装されています.言い換えれば、バリデーターは
オンチェーンまたはオフチェーンである必要があるか、担保を発行する必要がない場合があります
担保を発行します.

オーセンティケーターには、暗号化キーのペアと関連する番号があります.
"議決権".議決権は同じである必要はありません.

## バリデーターになる

ベリファイアになるには2つの方法があります.

1. [Genesis State](../tendermint-core/using-tendermint.md#genesis)で事前に確立できます.
2. ABCIアプリケーションは、EndBlockメッセージと変更に応答します
   既存のバリデーターセット.

## バリデーターを設定します

バリデーターを設定する場合、設定を構成する方法は無数にあります.このガイドは、そのうちの1つであるセントリーノードの設計を示すことを目的としています.この設計は主にDDOSを防ぐためのものです.

### ネットワークレイアウト

！[ALTネットワークレイアウト](./sentry_layout.png)

この図はAWSに基づいており、他のクラウドプロバイダーも同様のソリューションを設計ソリューションに提供します.ノードの実行はクラウドプロバイダーに限定されず、ベアメタルシステムでノードを実行することもできます.どの設定を使用する場合でも、アーキテクチャは同じです.

提案されたネットワーク図は、エンタープライズ環境での従来のバックエンド/フロントエンドサービスの分離に似ています.この場合、「バックエンド」はデータセンターベリファイアのプライベートネットワークです.データセンターネットワークには、複数のサブネット、ファイアウォール、および冗長機器が含まれる場合がありますが、この図では詳しく説明していません.重要な点は、データセンターが選択したクラウド環境への直接接続を可能にすることです. Amazon AWSには「DirectConnect」があり、GoogleCloudには「PartnerInterconnect」があります.これは、クラウドプロバイダーへの専用接続です(通常、いずれかのリージョンの仮想プライベートクラウドインスタンスへの直接接続).

すべてのセンチネルノード(「フロントエンド」)は、このプライベート接続を使用してバリデーターに接続します.オーセンティケータには、サービスを提供するためのパブリックIPアドレスがありません.

Amazonには、リージョン内に複数のアベイラビリティーゾーンがあります.セントリーノードは他の地域にも設置できます.この場合、2番目、3番目、およびそれ以上のリージョンは、バリデーターノードとのプライベート接続を確立する必要があります.これは、VPCピアリング(Google Cloudの「VPCネットワークピアリング」)を介して実現できます.この場合、2番目、3番目、およびそれ以上の地域のセンチネルノードは最初の地域に転送され、データセンターに直接接続することでバリデーターに到達します.

より耐久性のあるソリューション(図には詳細が示されていません)は、データセンターからさまざまなリージョンへの複数の直接接続を確立することです.このVPCピアリング接続は必須ではありませんが、センチネルノードにはメリットがあります.これにより、1つの領域に依存するリスクが克服されます.それはより高価です.

### ローカル構成

！[ALTローカル構成](./local_config.png)

バリデーターは提供された歩哨とのみ通信し、歩哨ノードは秘密の接続を介してバリデーターと通信し、通常の接続を介してネットワークの他の部分と通信します.センチネルノードは、相互に通信することも選択できます.

ノードを初期化するとき、変更が必要な可能性のある5つのパラメーターが `config.toml`にあります.

-`mode: `(full | validator | seed)ノードモード(デフォルト: 'full').ノードをバリデーターとして実行する場合は、「バリデーター」に変更してください.
-`pex: `ブール値.これにより、ノードのピアツーピア交換リアクターがオンまたはオフになります. `pex = false`の場合、接続に使用できるのは` persistent-peers`リストのみです.
-`persistent-peers: `常にオンラインであることが期待されるピアのリストを定義するための` nodeID @ ip:port`値のコンマ区切りリスト.これは、ノードが `pex = false`を設定してネットワークに参加できないため、最初の起動時に必要です.
-`unconditional-peer-ids: `ノードIDのコンマ区切りのリスト.これらのノードは、インバウンドピアとアウトバウンドピアの制限に関係なく接続されます.これは、センチネルノードに完全なアドレスブックがある場合に役立ちます.
-`private-peer-ids: `ノードIDのコンマ区切りのリスト.これらのノードはネットワークに送信されません.オーセンティケータIPがネットワークに送信されないようにするため、これは重要な領域です.
-`addr-book-strict: `ブール値.デフォルトでは、ルーティング可能なアドレスを持つノードが接続の対象と見なされます.この設定がオフ(false)の場合、ルーティング不可能なIPアドレス(プライベートネットワークのアドレスなど)がアドレス帳に追加される可能性があります.
-`double-sign-check-height`int64の高さ.ノードのコンセンサス投票が存在するかどうかを確認するために、コンセンサスに参加する前にバックトラックする必要があるブロックの数.ゼロ以外の場合、同じコンセンサスキーを使用して{double_sign_check_height}の最後のブロックに署名すると、ノードは再起動時にパニックになります. .したがって、ベリファイアはステートマシンを停止し、いくつかのブロックを待ってから、パニックを回避するためにステートマシンを再起動する必要があります.

####バリデーターノードの構成

| Config Option            | Setting                    |
| ------------------------ | -------------------------- |
| mode                     | validator                  |
| pex                      | false                      |
| persistent-peers         | list of sentry nodes       |
| private-peer-ids         | none                       |
| unconditional-peer-ids   | optionally sentry node IDs |
| addr-book-strict         | false                      |
| double-sign-check-height | 10                         |

ノードをバリデーターとして実行するには、「mode = validator」であることを確認してください. バリデーターノードは、ネットワーク全体に拡散しないように、 `pex = false`を持っている必要があります. 永続ノードはセンチネルノードになります. バリデーターは通信相手を隠そうとしないため、プライベートノードは空白のままにすることができます. 無条件ノードの設定は、完全なアドレスブックがないため、バリデーターにとってオプションです.

#### セントリーノードの構成

| Config Option          | Setting                                       |
| ---------------------- | --------------------------------------------- |
| mode                   | full                                          |
| pex                    | true                                          |
| persistent-peers       | validator node, optionally other sentry nodes |
| private-peer-ids       | validator node ID                             |
| unconditional-peer-ids | validator node ID, optionally sentry node IDs |
| addr-book-strict       | false                                         |

センチネルノードはネットワーク全体と通信できるはずなので、なぜ `pex = true`です.センチネルノードの永続的なピアがバリデーターになり、他のセンチネルノードになることもできます.センチネルノードは、ベリファイアのIPについてゴシップしないようにする必要があります.これを行うには、ベリファイアノードIDをプライベートノードとして使用する必要があります.無条件のピアIDは、バリデーターIDとオプションのその他のセンチネルノードになります.

>注:ノードのファイアウォールを設定するときは、それらを保護することを忘れないでください.

詳細については、次のリンクを参照してください.

-<https://kb.certus.one/>
-<https://forum.cosmos.network/t/sentry-node-architecture-overview/454>

### 検証キー

セットアップを設計するとき、検証者のコンセンサスキーを保護することが最も重要な要素です.ノードの作成時にベリファイアによって提供されるキーはコンセンサスキーと呼ばれ、ブロックに投票するには常にオンラインである必要があります. **非推奨**デフォルトのjsonファイル( `priv_validator_key.json`)にのみ秘密鍵を保存します.幸い、[Interchain Foundation](https://interchain.io/)はチームと協力して、検証者用の鍵管理サーバーを構築しました.使用方法に関するドキュメントは[こちら](https://github.com/iqlusioninc/tmkms)にあり、本番環境で広く使用されています.このツールの使用に限定されるものではなく、[HSM](https://safenet.gemalto.com/data-encryption/hardware-security-modules-hsms/)があり、推奨されるHSMはありません.

現在、Tendermintは[Ed25519](https://ed25519.cr.yp.to/)キーを使用しています.これらのキーは、セキュリティ部門とHSMによって広くサポートされています.

## ブロックを送信する

> ** +2/3は「2/3以上」の略です**

バリデーターがシンボルの+2/3を設定したとき[precommit
投票](https://github.com/tendermint/spec/blob/953523c3cb99fdb8c8f7a2d21e3a99094279e9de/spec/blockchain/blockchain.md#vote)同じ「ラウンド」のブロックに投票します.
事前に提出された投票の+2/3グループが呼び出されます
[_commit _](https://github.com/tendermint/spec/blob/953523c3cb99fdb8c8f7a2d21e3a99094279e9de/spec/blockchain/blockchain.md#commit).そして+2/3セット
同じ高さとラウンドの同じブロックの事前コミットは、次のように使用できます.
検証、仕様の提出は次のブロックに含まれます(を参照)
[LastCommit](https://github.com/tendermint/spec/blob/953523c3cb99fdb8c8f7a2d21e3a99094279e9de/spec/blockchain/blockchain.md#lastcommit)).
