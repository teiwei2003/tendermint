# ADR45-ABCI証拠処理

## 変更ログ
* 2019年9月21日:最初のドラフト

## 環境

プルーフはテンダーミントブロックのユニークなコンポーネントであり、独自のリアクターを備えています
優先度の高いゴシップに使用されます。現在、テンダーミントは単一の形式の証拠、明確な証拠のみをサポートしています
あいまいな、バリデーターは同時に競合するブロックに署名します
高さ/ラウンド。コンセンサスリアクターでリアルタイムに検出され、ゴシップされます
証拠リアクターを通過します。証拠はRPCを介して提出することもできます。

現在、Tendermintはメインチェーンのフォークを適切に処理できません。
フォークが検出されると、ノードはパニックになります。現時点では、手動による介入と
社会的コンセンサスを再構成する必要があります。もっとやりたい
ここはエレガントですが、それはまた別の日です。

フォークなしでライトクライアントをだますことができます
メインチェーン-いわゆるFork-Lite。見る
[フォークの説明責任](https://docs.tendermint.com/master/spec/light-client/accountability/)
詳細については、ドキュメントを参照してください。クライアントの合理化されたバージョンの場合、これは次の方法で実行できます。
あいまいな攻撃または記憶喪失の攻撃。スキップライトクライアントの場合、これも発生する可能性があります
クレイジーなバリデーターを介して攻撃します。アプリケーションには、罰する方法が必要です
あらゆる形態の不正行為。

重要な問題は、テンダーミントが証拠を管理すべきかどうかです
検証、または証拠がトランザクションのようなものである必要があるかどうか(つまり、
任意のバイト)そしてアプリケーションにそれを処理させます(すべての署名を含む)
試験)。

現在、証拠の検証はテンダーミントによって処理されています。約束したら、
[証拠は通過しました
ABCI](https://github.com/tendermint/tendermint/blob/master/proto/tendermint/abci/types.proto#L354)
BeginBlockの簡略化された形式では、
証拠の種類、その高さとタイムスタンプ、それが由来するバリデーター、および
バリデーターの総投票権は高いレベルに設定されています。アプリケーションはTendermintを信頼します
ABCI証拠には含まれていないため、証拠検証を実行します
自己検証のためのアプリケーションの署名およびその他のデータ。

テンダーミントでの証拠の取り扱いを支持する議論:

1)フルノードへの攻撃は、フルノードがリアルタイムで検出できる必要があります。コンセンサスリアクター内。
  したがって、少なくとも、何かを含む証拠は完全にだまされる可能性があります
  ノードはTendermintによってローカルで処理される必要があります。そうでない場合、方法はありません。
  ABCIアプリがそれを検出するために使用します(つまり、この期間中に受け取ったすべての投票を送信するわけではありません
  アプリケーションに関するコンセンサス...)。

2)Amensia攻撃は簡単に検出できません-インタラクティブな攻撃が必要です
  過去の理由を提出するためのすべてのバリデーター間の合意
  チケット。私たちは[これを行う方法について
  現在](https://github.com/tendermint/tendermint/blob/c67154232ca8be8f5c21dff65d154127adc4f7bb/docs/spec/consensus/fork-detection.md)
  一元化された
  データを集約するための信頼できるライブネス監視サービス
  現在および過去のバリデーター。ただし、不正行為の証拠が作成されます(つまり、
  記憶喪失を通して)、ブロックチェーンを含め、誰でも確認できます。
  バリデーターは、関連するすべてのコンセンサス投票を提出する必要があります
  彼らの事前コミットメントを正当化する高さ。これはテンダーミント独自のものです
  契約がアップグレードされると、契約が変更される場合があります。恥ずかしいです
  アプリケーションからこれを調整します。

3)エビデンスゴシップはtxゴシップに似ていますが、もっと高いはずです
  優先順位。メモリプールはまだ優先順位の概念をサポートしていないため、
  証拠は、ユニークな証拠リアクターを介したゴシップです。ただ扱うなら
  他のトランザクションと同様に、証拠は完全にアプリケーションに委ねられます。
  テンダーミントは、私たちがいない限り、優先順位を決定する方法を知ることができません
  メモリプールを大幅にアップグレードします。したがって、証拠の処理を継続する必要があります
  ABCIを明確にして更新し、次の方法で証拠の送信をサポートします
  CheckTx/DeliverTx、または新しいCheckEvidence/DeliverEvidenceメソッドを導入します。
  いずれの場合も、ABCIにさらに変更を加える必要があり、Tendermintの場合はさらに変更を加える必要があります。
  問題に対処するために、含めることができる別の種類の証拠のサポートを追加しました
  スターティングブロック内。

4)すべてのABCIアプリケーションフレームワークは、大部分の重い作業の恩恵を受けます
  テンダーミントによって処理されます。全員が再実装する必要はありません。
  各言語のすべての証拠検証ロジック。

証拠処理をアプリに移行することを支持する議論:

5)liteクライアントをスキップして、すべてのバリデーターのコレクションを追跡するように要求します
  バリデーターがバインドを解除したが、それでも
  スラッシュ可能なフラグは、ライトクライアントをだますための無効なヘッダーです。 Cosmos-SDK
  ステーキング/スラッシュモジュールは、スラッシュに使用されるため、これを追跡します。
  Tendermintは現在これを追跡していませんが、追跡しています
  バリデーターは各高さに設定されます。これは証拠を管理する傾向があります
  アプリケーションは、履歴バリデーターセットデータの冗長な管理を回避します
  肌の若返り

6)クロスチェーン検証をサポートするアプリケーションを処理する必要があります
  他のチェーンからの証拠。これらのデータは、トランザクションの形式で表示されます。
  ただし、これは、アプリが処理するすべての機能を備えている必要があることを意味します
  自身のチェーンの証拠が直接処理されたとしても、証拠
  肌の若返り。

7)ライトクライアントからの証拠は大きく、何らかの形のDoSを構成している可能性があります
  完全なノードのベクトル。トランザクションに入れると、アプリケーションの料金を請求できます
  虚偽の証拠があった場合に執行費用を支払うメカニズム。
  これは、証拠提出者が余裕がなければならないことを意味します
  提出しますが、証拠が有効な場合は、もちろん返送する必要があります。
  つまり、負担は主にノード全体にあり、必ずしもメリットがあるとは限りません。
  コストから。


## 決定

上記のほとんどは、証拠テストがテンダーミントに属していることを示しているようです。
(5)テンダーミントには特に大きな義務は課せられず、(6)のみ
アプリケーションがTendermintライブラリを使用できることを意味します。言い換えれば、(7)は潜在的です
バリデーターとは関係のない完全なノードを攻撃する可能性はありますが、いくつかの懸念が生じます
(つまり、費用の恩恵を受けないでください)。これは、たとえば帯域外で処理できます
すべてのノードは、支払いチャネルまたは特定のチャネルを介してライトクライアントサービスを提供します
その他の支払いサービス。これは、クライアントIPを禁止することで軽減することもできます。
不良データを送信します。お客様からは実際にたくさん送られてきますのでご注意ください
データが最初に来ます。

別のADRは、Tendermintがこれらの新しい形式の
説明されている監視プロトコルにどのように参加するかについての証拠
フォーク
検出](https://github.com/tendermint/tendermint/blob/c67154232ca8be8f5c21dff65d154127adc4f7bb/docs/spec/consensus/fork-detection.md)ドキュメント、
また、過去のバリデーターを追跡し、DoSの問題を管理する方法。

## ステータス

提案しました。

## 結果

### ポジティブ

-ABCIに実際の変更はありません
-Tendermintはすべてのアプリケーション証拠を処理します

### ニュートラル

-TendermintRPCでのサービス拒否に注意を払う必要があります

### ネガティブ

-Tendermintは、この期間中にバリデーターとして機能したすべての公開鍵を追跡することにより、データをコピーします
  拘束力のない期間
