# ADR 013:対称暗号化の必要性

## 環境

SDKのキーを暗号化する方法を処理するには、対称暗号が必要です。
また、テンダーミントで `priv_validator.json`を暗号化する場合があります。

現在、対称暗号化をサポートするためにAEADを使用しています。
プライバシーと信頼性に加えて、データの整合性も必要になるため、これは良いことです。
現在、データの整合性なしで暗号化するシナリオはありません。
したがって、AEADのみを使用するようにコードを最適化できます。
現在、AEADを簡単に切り替える方法はありません。このADRは1つの方法の概要を示しています
これらは簡単に交換できます。

### AEAD暗号化の使用方法

キーに加えて、AEADは通常乱数を必要とします。
対称暗号化の目的で、
ステートレスにするには暗号化が必要です。
したがって、乱数を使用します。
(したがって、AEADは乱数をサポートする必要があります)

現在、乱数を作成し、それを使用してデータを暗号化しています。
戻り値は `nonce ||暗号化されたデータ`です。
これの制限は、それが識別の方法を提供しないということです
暗号化で使用されるアルゴリズム。
したがって、復号化に複数のアルゴリズムを使用することは最適ではありません。
(すべて試してみる必要があります)

## 決定

新しい `crypto/encoding/symmetric`パッケージに次の2つのメソッドを作成する必要があります。

`` `golang
func Encrypt(aead cipher.AEAD、plaintext [] byte)(ciphertext [] byte、err error)
func Decrypt(key [] byte、ciphertext [] byte)(plaintext [] byte、err error)
func Register(aead cipher.AEAD、algo_name string、NewAead func(key [] byte)(cipher.Aead、error))エラー
`` `

これにより、暗号化アルゴリズムを指定できますが、必ずしもそうとは限りません。
復号化中です。
これは、人員を除いて、ダウンストリームアプリケーションで使いやすくするためです。
ファイルを直接見てください。
欠点の1つは、暗号化機能の場合、AEADを初期化する必要があることです。
しかし、これは問題ではないと思います。

暗号化にエラーがない場合、Encryptは `algo_name ||乱数|| aead_ciphertext`を返します。
`algo_name`は、標準のvaruintエンコーディングを使用して、長さのプレフィックスである必要があります。
これは2進数のデータになりますが、乱数と暗号文も2進数であることを考えると、これは問題ではありません。

このソリューションでは、aeadタイプから名前へのマッピングが必要です。
これは、振り返りによって実現できます。

```golang
func getType(myvar interface{}) string {
    if t := reflect.TypeOf(myvar); t.Kind() == reflect.Ptr {
        return "*" + t.Elem().Name()
    } else {
        return t.Name()
    }
}
```

次に、 `getType(aead)`によって返される名前から `algo_name`へのマッピングを維持します。

復号化では、 `algo_name`を読み取り、キーを使用して新しいAEADをインスタンス化します。
次に、提供された乱数/暗号文に対してAEAD復号化メソッドを呼び出します。

`Register`を使用すると、ダウンストリームユーザーは目的のAEADを対称パッケージに追加できます。
AEAD名がすでに登録されている場合は、エラーが発生します。
これにより、悪意のあるインポートが実行時にAEADを変更/キャンセルするのを防ぎます。

## 実装戦略

提案されたコンテンツのgolangの実装はかなり単純です。
心配なのは、これに切り替えるだけで、既存の秘密鍵が破壊されることです。
これに関連する場合は、秘密鍵をデコードする必要のない簡単なスクリプトを作成できます。
古い形式から新しい形式に変換するために使用されます。

## ステータス

提案しました。

## 結果

### ポジティブ

-復号化を容易にする方法で新しいAEADをサポートできるようにします
-ダウンストリームユーザーが独自のAEADを追加できるようにする

### ネガティブ

-ディスクに保存されているすべての秘密鍵を解読する必要があります。
   シードワードを使用して復元でき、アップグレードスクリプトも非常に簡単です。

### ニュートラル

-呼び出し元は、秘密鍵を使用してAEADをインスタンス化する必要があります。
   ただし、使用している署名アルゴリズムを知る必要があります。これは肯定的なことです。
