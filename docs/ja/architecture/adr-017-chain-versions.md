# ADR 017:チェーンバージョン

## やること

-ChainIDが変更されたときにスラッシュを処理する方法を明確にしました

## 変更ログ

-28-07-2018:レビューの更新
  -2つのADRに分割-1つはプロトコル用、もう1つはチェーン用
-16-07-2018:初期ドラフト-最初はプロトコルとチェーンの共同ADR
  バージョン

## 環境

ソフトウェアとプロトコルのバージョンは、別のADRに含まれています.

ここでは、チェーンバージョンに焦点を当てます.

## 必須

プロトコル、ネットワーク、フォークなどのブロックチェーンをバージョン管理する必要があります.
多くのチェーンについて話し合うことができるように、チェーンの識別子と説明が必要です.
特にそれらの間の違いは、意味のある方法で.

### インターネット

同じバージョンのソフトウェアを実行している多くの独立したネットワークをサポートする必要があります.
同じ初期状態から開始することもできます.
ピアが参加している識別子を認識できるように、それらは異なる識別子を持っている必要があります
検証者とユーザーは、リプレイ攻撃を防ぐことができます.

これを「NetworkName」と呼びます(現在、ソフトウェアでは「ChainID」と呼んでいます.これでは
ADRとChainIDの意味は異なります).
実行中のアプリケーションとコミュニティまたはインテントを表します
それを実行します.

ピアは、同じNetworkNameを持つ他のピアにのみ接続されます.

### フォーク

既存のネットワークのアップグレードとフォークをサポートする必要があります.これらのネットワークでは、次のいずれかを実行できます.

    -特定の高さに戻し、同じバージョンで新しいブロックを引き続き使用します
    -特定の高さで任意に状態を変更し、同じバージョンを引き続き使用します(例:Dao Fork)
    -特定の高さでAppVersionを変更します

テンダーミントの議決権のしきい値ルールにより、チェーンは「元の」ルールと新しいルールの下でのみ拡張できることに注意してください
1/3以上が二重署名である場合、これは明示的に禁止されており、両方のチェーンで罰せられることになります.彼らはレビューできるので
ペナルティとして、チェーンはバリデーターを削除するためにハードフォークされることが予想されます.したがって、両方のブランチがフォークの後に続く場合、
それぞれに新しい識別子が必要であり、古いチェーン識別子は削除されます(つまり、履歴の同期にのみ役立ち、新しいブロックには役立ちません).

TODO:チェーンIDが変更されたときにスラッシュを処理する方法を説明してください！

フォークを説明するための一貫した方法が必要です.

## 提案

###チェーンの説明

ChainDescriptionは、ブロックチェーンの完全な不変の説明です.次の形式を取ります.

```
ChainDescription = <NetworkName>/<BlockVersion>/<AppVersion>/<StateHash>/<ValHash>/<ConsensusParamsHash>
```

ここで、StateHashは初期状態のメルケルルートであり、ValHashは初期テンダーミントバリデーターセットのメルケルルートです.
ConsensusParamsHashは、初期のTendermintコンセンサスパラメーターのメルケルルートです.

`genesis.json`ファイルには、この値を計算するのに十分な情報が含まれている必要があります. StateHashまたはValHash自体を含める必要はありません.
ただし、インクルードは、特定のプロトコルバージョンを使用してステータスを計算できます.

注:NetworkNameをNetworkNameとAppNameに分割することを検討してください-これにより、
人々は独立して、異なるネットワークに同じアプリケーションを使用します(つまり、
複数のバリデーターコミュニティが使用するハブを構築したいとします
同じアプリケーションですが、ネットワーク名が異なります.必要がなければないと言えます
違いは、異なる初期状態/バリデーターから生じます).

#### チェーンID

`ChainID = TMHASH(ChainDescriptor)`を定義します.ブロックチェーンの一意のIDです.

ユーザーが処理する場合は、たとえばBech32でエンコードする必要があります.接頭辞 `cosmoschain`が付いています.

#### フォークとアップグレード

チェーンがフォークまたはアップグレードしても同じ履歴が続く場合は、次のように新しいChainDescriptionが必要です.

```
ChainDescription = <ChainID>/x/<Height>/<ForkDescription>
```

どこ

-ChainIDは、前のChainDescriptionからのChainIDです(つまり、そのハッシュ)
-`x`は変更を意味します
-`Height`は変更された高さです
-ForkDescriptionの形式はChainDescriptionと同じですが、フォークに使用されます
-これにより、フォークでテンダーミントまたはアプリケーションの新しいバージョンを指定したり、状態またはバリデーターセットを変更したりできます.
