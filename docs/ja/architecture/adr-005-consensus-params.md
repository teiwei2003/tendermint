# ADR 005:コンセンサスパラメータ

## 環境

これまでのところ、ブロックチェーンの容量を制御する主要なコンセンサスパラメータは、ハードコーディングされているか、ローカル構成からロードされているか、無視されています。
それらは異なるネットワークで異なる必要があり、時間とともに進化する可能性があるためです
ネットワークでは、ジェネシスファイルでそれらを初期化し、ABCIを介して公開しようとしました。

現在、最大ブロックやトランザクションサイズなど、いくつかの特定のパラメータがありますが、将来的にはさらに多くのパラメータが必要です。
たとえば、証拠が有効である期間やチェックポイントの頻度などです。

## 決定

### コンセンサスパラメータ

`config.toml`に一貫したキーパラメータがないはずです。

新しいConsensusParamsは、オプションで `genesis.json`ファイルに含まれています。
そして、「ステータス」にロードされます。 含まれていないアイテムはすべてデフォルト値に設定されます。
値0は未定義です(以下のABCIを参照)。 値-1は、パラメーターが適用できないことを示すために使用されます。
これらのパラメーターは、関連するすべてのパラメーターの結合を通じてブロック(およびtx)の有効性を判別するために使用されます。

```
type ConsensusParams struct {
    BlockSize
    TxSize
    BlockGossip
}

type BlockSize struct {
    MaxBytes int
    MaxTxs int
    MaxGas int
}

type TxSize struct {
    MaxBytes int
    MaxGas int
}

type BlockGossip struct {
    BlockPartSizeBytes int
}
```

`ConsensusParams`は、コンセンサスルールのさまざまな側面をカバーする新しい構造を追加することにより、時間の経過とともに進化する可能性があります。

`BlockPartSizeBytes`と` BlockSize.MaxBytes`は強制的に0より大きくなります。
前者はパーツサイズが必要なためであり、後者はブロックサイズに対して少なくともいくつかの健全性チェックを常に実行できるようにするためです。

### ABCI

#### 初期化チェーン

InitChainは現在、バリデーターの初期セットを使用しています。 ConsensusParamsの一部も含めるように拡張する必要があります。
創造物に何かがない限り、それを創世記全体を占めるようにすることができるいくつかの状況があります、
BlockPartSizeと同様に、アプリケーションは実際には認識すべきではありません。

#### エンドブロック

EndBlock応答には、BlockSizeとTxSizeを含むConsensusParamsが含まれますが、BlockGossipは含まれません。
将来、他のパラメータ構造を `ConsensusParams`に追加することができます。
`0`の値は、変更がないことを示すために使用されます。
その他の値は、「State.ConsensusParams」のパラメーターを更新して、次のブロックに適用します。
Tendermintには、健全性チェックとしてハードコードされた上限が必要です。

## ステータス

実装

## 結果

### ポジティブ

-代替の容量制限とコンセンサスパラメータを指定するためにソフトウェアを再コンパイルする必要はありません。
-アプリの制御下で時間の経過とともに変化することもあります

### ネガティブ

-公開されるパラメータが多いほど、複雑になります
-ブロックチェーンのさまざまな高さでのさまざまなルールにより、高速同期が複雑になります

## #ニュートラル

-有効性をチェックするためのTxSizeは、プロポーザルのサイズを決定する構成の `max_block_size_tx`と競合する可能性があります
