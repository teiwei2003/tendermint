# ADR 051:二重署名リスクの削減

## 変更ログ

* 27-11-2019:最初のドラフト
* 13-01-2020:2つのADRに分割され、このADRはデュアル署名保護とADR-052処理テンダーミントモードのみをカバーします
* 22-01-2020:タイトルを「ダブルシグニチャ保護」から「ダブルシグニチャリスク削減」に変更

## 環境

検証者によって誤って実行された二重署名イベントのリスクを軽減する方法を提供します
-ベリファイアが誤って重複ベリファイアを実行し、二重署名イベントが発生することがよくあります
-この提案の機能は、投票を開始する前に最も近いNブロックをチェックすることにより、誤った二重署名イベントのリスクを減らすことです.
-二重署名イベントの深刻な影響を考慮すると、ノードデーモンに複数のリスク削減アルゴリズムを組み込むことは非常に合理的です.

## 決定

二重署名のリスクを減らす方法を提案したいと思います.

-方法論:最新のコンセンサス結果をクエリして、ノードのコンセンサスキーが最近コンセンサスに使用されたかどうかを理解します
-いつ確認するか
    -ステートマシンが完全に同期された後に `ConsensusReactor`を起動したとき
    -ノードがバリデーターの場合(privValidatorを使用)
    -`cs.config.DoubleSignCheckHeight> 0`の場合
-確認方法
    1.ベリファイアが同期状態から完全同期状態に変わると、ステートマシンはベリファイアのコンセンサスキーを使用して、最も近いNブロック( `latest_height-double_sign_check_height`)をチェックし、コンセンサス投票があるかどうかを確認します.
    2.検証者のコンセンサスキーに投票がある場合は、ステートマシンプログラムを終了します
-構成
    -`config.toml`とcliに `double_sign_check_height`パラメータを導入して、投票を確認および確認するステートマシンの数を提案します.
    -<span v-pre> `double_sign_check_height = {{.Consensus.DoubleSignCheckHeight}}` </ span> in `config.toml`
    -`cliのtendermintノード--consensus.double_sign_check_height`
    -"double_sign_check_height == 0"の場合、ステートマシンはチェックプロセスを無視します

## ステータス

実装

## 結果

### ポジティブ

-ベリファイアは、誤った二重署名イベントを回避できます. (たとえば、別のバリデーターノードがコンセンサスに投票している場合、同じコンセンサスキーで新しいバリデーターノードを開始すると、コンセンサスキーが最新のブロックで見つかったため、ステートマシンがパニック停止します.コンセンサス投票)
-この方法で、ほとんどの誤った二重署名イベントを防ぐことができることを願っています.

### ネガティブ

-リスク低減方法がオンになっている場合、検証ノードを再起動するとパニックが発生します.これは、ノード自体が同じコンセンサスキーを使用して投票し、コンセンサスに到達するためです.したがって、バリデーターはステートマシンを停止し、いくつかのブロックを待ってから、パニック停止を回避するためにステートマシンを再起動する必要があります.

### ニュートラル

## 参照する

-問題[#4059](https://github.com/tendermint/tendermint/issues/4059):二重署名保護
