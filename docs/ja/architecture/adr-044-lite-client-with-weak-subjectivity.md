# ADR 044:主観性の弱い軽いクライアント

## 変更ログ
* 13-07-2019:最初のドラフト
* 14-08-2019:cwgosのコメントに対応

## 環境

ライトクライアントの概念は、ビットコインホワイトペーパーで紹介されています。それ
検証するだけの分散型コンセンサスプロセスのオブザーバーについて説明します
コンセンサスアルゴリズムは、それらの間のステートマシントランザクションではありません。

Tendermintライトクライアントは、スマートフォン、低電力組み込みチップ、その他のブロックチェーンなど、帯域幅とコンピューティングに制約のあるデバイスを可能にします
Tendermintブロックチェーンのコンセンサスを効果的に検証します。これが形成された
新しいネットワークノードの安全で効率的な状態同期の基盤と
ブロックチェーン間通信(Tendermintインスタンスの1つのライトクライアント
別のチェーンのステートマシンで実行します)。

不正行為に対して検証者を確実に罰することが期待されるネットワーク
場所を変更するために結合された権利とバリデーターセットを減らすことによって
まれに、お客様がこの仮定を使用して安全に使用できる場合
中間ヘッダーをダウンロードせずに、liteクライアントを同期できます。

プルーフオブステーク環境で実行されているライトクライアント(およびフルノード)には、1つ必要です。
信頼できるソースからの信頼できるブロックの高さは、1unbindを超えません
ウィンドウと構成可能な証拠提出同期バインディング。これがいわゆる「弱い主観」です。

プルーフオブステークブロックチェーンは、主観的である必要があります。
攻撃者は、無料でバインドされなくなった投票キーを購入できます
以前の履歴のある時点でネットワークをフォークします。 Vitalikの投稿を参照してください:
[公平性の証明:弱者を愛することをどのように学ぶか
主観性](https://blog.ethereum.org/2014/11/25/proof-stake-learned-love-weak-subjectivity/)。

現在、テンダーミントは
[light](https://github.com/tendermint/tendermint/tree/master/light)パッケージ。この
liteクライアントは、バイナリ検索を使用しようとするバイナリ検索アルゴリズムを実装します
バリデーターが投票するためのブロックヘッダーの最小数を見つけます
電力変化は<1/3未満です。このインターフェースはweakをサポートしていません
現時点での主観。 CosmosSDKは反事実もサポートしていません
カット、ライトクライアントには証拠の作成を報告する機能がありません
これらのシステムは*理論的には安全ではありません*。

注:Tendermintは、わずかに異なる(より強力な)軽量クライアントモデルを提供します
日食ノードは光をだますことができるだけなので、日食の下のビットコインより
クライアント(最後の信頼ルートからの秘密鍵の3分の2を持っている場合)。

## 決定

###弱く主観的なインターフェース

新しいライトクライアント接続を追加するときの弱い主観的なインターフェイス
ネットワークまたはライトクライアントのオフライン時間が超過した場合
アンバンドリング期間中にネットワークに接続します。具体的には、ノードには
ユーザー入力から同期する前に、次の構造を初期化します。

```
type TrustOptions struct {
    // Required: only trust commits up to this old.
    // Should be equal to the unbonding period minus some delta for evidence reporting.
    TrustPeriod time.Duration `json:"trust-period"`

    // Option 1: TrustHeight and TrustHash can both be provided
    // to force the trusting of a particular height and hash.
    // If the latest trusted height/hash is more recent, then this option is
    // ignored.
    TrustHeight int64  `json:"trust-height"`
    TrustHash   []byte `json:"trust-hash"`

    // Option 2: Callback can be set to implement a confirmation
    // step if the trust store is uninitialized, or expired.
    Callback func(height int64, hash []byte) error
}
```

ユーザーが信頼できるソースからこの情報を取得することを期待します
たとえば、検証者、友人、または安全なWebサイトです。より人道的
信頼バランスのあるソリューションは、httpsに基づいてプロトコルを構築することです。
この情報を入力するためのデフォルトのエンドポイント。オンチェーンレジストリでもあります
信頼の根源(たとえば、コスモスハブ)は将来明らかになる可能性があります。

###線形検証

線形検証アルゴリズムは、すべてのヘッダーをダウンロードする必要があります
`TrustHeight`と` LatestHeight`の間。ライトクライアントのダウンロード
「TrustHeight」の完全なヘッダーを入力してから、「N +1」のダウンロードに進みます
ヘッダーと適用[テンダーミント検証
ルール](https://docs.tendermint.com/master/spec/blockchain/blockchain.html#validation)
各ブロックに。

### 第2部の検証

バイナリ検証は、帯域幅と計算量の多いメカニズムであり、
最も楽観的なケースでは、ライトクライアントは2つのブロックのみをダウンロードする必要があります
同期に向かいます。

バイナリアルゴリズムは次のように実行されます。クライアントのダウンロード
そして、「TrustHeight」の完全なブロックヘッダーを確認してから、
`LatestHeight`インターセプターのタイトル。次に、クライアントは「最新の高度」を確認します
タイトル。最後に、クライアントは次のメソッドを使用して「LatestHeight」ヘッダーを検証しようとします
`TrustHeight`ヘッダーの` NextValidatorSet`から議決権を取得します。この
`TrustHeight`のバリデーターがまだ> 2/3の場合、検証は成功します
「最新の高さ」で+1の投票権を取得します。成功した場合、クライアントは完全に
同期します。失敗した場合は、バイナリアルゴリズムに従う必要があります
埋め込む。

クライアントは中央のブロックのブロックをダウンロードしようとします
`LatestHeight`と` TrustHeight`を使用して、上記と同じアルゴリズムを試してください
`LatestHeight`の代わりに` MidPointHeight`を使用し、さまざまなしきい値を使用します-
*隣接していないタイトル* 1/3 + 1議決権。失敗した場合、
成功するまで `MidPoint`検証を再帰的に実行してから、再起動します
「NextValidatorSet」と「TrustHeight」が更新されました。

クライアントが偽造されたヘッダーに遭遇した場合、クライアントはヘッダーを一緒に送信する必要があります
他の人に対する不正行為の証拠としてのいくつかの他の中間の見出し
フルノード。その後、別のフルノードを使用して2つのポイントを再試行できます。一
最適なクライアントは、最小化するために最後の実行からの信頼できるヘッダーをキャッシュします
ネットワークの使用。

---

公式仕様を見る
[こちら](https://github.com/tendermint/spec/tree/master/spec/light-client)。

## ステータス

実装

## 結果

### ポジティブ

*安全に使用できる軽量クライアント(オフラインにすることもできますが、長すぎないようにしてください)

### ネガティブ

*半分にすることの複雑さ

### ニュートラル

*社会的コンセンサスはエラーが発生しやすい可能性があります(新しいライトクライアントの場合)
  ネットワークに参加するか、オフラインになりすぎる)
